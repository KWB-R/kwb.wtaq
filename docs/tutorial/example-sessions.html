<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Tutorial for R package kwb.wtaq</title>
  <meta name="description" content="This is a tutorial of using the kwb.wtaq package">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Tutorial for R package kwb.wtaq" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a tutorial of using the kwb.wtaq package" />
  <meta name="github-repo" content="KWB-R/kwb.wtaq" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tutorial for R package kwb.wtaq" />
  
  <meta name="twitter:description" content="This is a tutorial of using the kwb.wtaq package" />
  

<meta name="author" content="Hauke Sonnenberg &amp; Michael Rustler (Kompetenzzentrum Wasser Berlin gGmbH)">


<meta name="date" content="2018-07-10">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="intro.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WTAQ tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#background"><i class="fa fa-check"></i><b>2.1</b> Background</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#objective"><i class="fa fa-check"></i><b>2.2</b> Objective</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#preparation"><i class="fa fa-check"></i><b>2.3</b> Preparation</a><ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#installation-of-required-r-packages"><i class="fa fa-check"></i><b>2.3.1</b> Installation of required R packages</a></li>
<li class="chapter" data-level="2.3.2" data-path="intro.html"><a href="intro.html#loading-the-package"><i class="fa fa-check"></i><b>2.3.2</b> Loading the package</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#using-the-package-help"><i class="fa fa-check"></i><b>2.4</b> Using the package help</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="example-sessions.html"><a href="example-sessions.html"><i class="fa fa-check"></i><b>3</b> Example sessions</a><ul>
<li class="chapter" data-level="3.1" data-path="example-sessions.html"><a href="example-sessions.html#level-1-one-pumping-well"><i class="fa fa-check"></i><b>3.1</b> Level 1: One pumping well</a><ul>
<li class="chapter" data-level="3.1.1" data-path="example-sessions.html"><a href="example-sessions.html#pumping-test-data"><i class="fa fa-check"></i><b>3.1.1</b> Pumping test data</a></li>
<li class="chapter" data-level="3.1.2" data-path="example-sessions.html"><a href="example-sessions.html#model-parameterisation"><i class="fa fa-check"></i><b>3.1.2</b> Model parameterisation</a></li>
<li class="chapter" data-level="3.1.3" data-path="example-sessions.html"><a href="example-sessions.html#model-run"><i class="fa fa-check"></i><b>3.1.3</b> Model run</a></li>
<li class="chapter" data-level="3.1.4" data-path="example-sessions.html"><a href="example-sessions.html#analysing-results"><i class="fa fa-check"></i><b>3.1.4</b> Analysing results</a></li>
<li class="chapter" data-level="3.1.5" data-path="example-sessions.html"><a href="example-sessions.html#model-calibration"><i class="fa fa-check"></i><b>3.1.5</b> Model calibration</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="example-sessions.html"><a href="example-sessions.html#level-2-multiple-pumping-wells"><i class="fa fa-check"></i><b>3.2</b> Level 2: Multiple pumping wells</a><ul>
<li class="chapter" data-level="3.2.1" data-path="example-sessions.html"><a href="example-sessions.html#model-parameterisation-1"><i class="fa fa-check"></i><b>3.2.1</b> Model parameterisation</a></li>
<li class="chapter" data-level="3.2.2" data-path="example-sessions.html"><a href="example-sessions.html#model-run-1"><i class="fa fa-check"></i><b>3.2.2</b> Model run</a></li>
<li class="chapter" data-level="3.2.3" data-path="example-sessions.html"><a href="example-sessions.html#analysing-results-1"><i class="fa fa-check"></i><b>3.2.3</b> Analysing results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>4</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/KWB-R" target="blank">Published by KWB</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tutorial for R package kwb.wtaq</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-sessions" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Example sessions</h1>
<div id="level-1-one-pumping-well" class="section level2">
<h2><span class="header-section-number">3.1</span> Level 1: One pumping well</h2>
<div id="pumping-test-data" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Pumping test data</h3>
<p>We have provided an example dataset “drawdowns” containing four different pumping
tests with measured drawdown time-series in five different wells (production well
and four observation wells). You can load the dataset by running:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;drawdowns&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;kwb.wtaq&quot;</span>)</a></code></pre></div>
<p>Let’s have a short look to the dataset. It is a list of four data frames as
the R command “str” reveals:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">str</span>(drawdowns)</a></code></pre></div>
<pre><code>## List of 4
##  $ W1:&#39;data.frame&#39;:  15 obs. of  6 variables:
##   ..$ time.in.seconds: num [1:15] 420 1020 1620 2820 4020 ...
##   ..$ W1             : num [1:15] 1.25 1.42 1.46 1.52 1.56 ...
##   ..$ W2             : num [1:15] 0.02 0.04 0.05 0.07 0.08 ...
##   ..$ W3             : num [1:15] 0 0.01 0.01 0.02 0.03 ...
##   ..$ W4             : num [1:15] 0 0 0.01 0.02 0.02 ...
##   ..$ W5             : num [1:15] 0 0.01 0.01 0.01 0.01 ...
##  $ W2:&#39;data.frame&#39;:  15 obs. of  6 variables:
##   ..$ time.in.seconds: num [1:15] 120 720 1320 2520 3720 ...
##   ..$ W2             : num [1:15] 1.2 1.73 1.62 1.68 1.75 ...
##   ..$ W1             : num [1:15] 0.01 0.05 0.06 0.09 0.1 ...
##   ..$ W3             : num [1:15] 0 0.02 0.03 0.05 0.06 ...
##   ..$ W4             : num [1:15] 0 0 0.01 0.01 0.02 ...
##   ..$ W5             : num [1:15] 0 0.01 0.01 0.01 0.01 ...
##  $ W4:&#39;data.frame&#39;:  15 obs. of  6 variables:
##   ..$ time.in.seconds: num [1:15] 60 660 1260 2460 3660 ...
##   ..$ W4             : num [1:15] 0.5 0.76 0.79 0.82 0.84 ...
##   ..$ W1             : num [1:15] 0 0 0.01 0.02 0.02 ...
##   ..$ W2             : num [1:15] 0.01 0.01 0.01 0.02 0.03 ...
##   ..$ W3             : num [1:15] 0.01 0.05 0.06 0.08 0.1 ...
##   ..$ W5             : num [1:15] 0.01 0.04 0.05 0.07 0.08 ...
##  $ W5:&#39;data.frame&#39;:  15 obs. of  6 variables:
##   ..$ time.in.seconds: num [1:15] 600 1200 1800 2400 3600 5400 7200 10800 15000 21600 ...
##   ..$ W5             : num [1:15] 0.73 0.74 0.75 0.77 0.78 ...
##   ..$ W1             : num [1:15] 0 0 0 0.01 0.01 ...
##   ..$ W2             : num [1:15] 0 0 0 0 0 ...
##   ..$ W3             : num [1:15] 0.01 0.01 0.01 0.01 0.02 ...
##   ..$ W4             : num [1:15] 0.04 0.04 0.06 0.06 0.07 ...</code></pre>
<p>The four list elements represent four different pumping tests (in “W1”, “W2”, “W4”
and “W5”. The resulting drawdowns of each pumping test are stored in a data frame
of six columns. Column “time.in.seconds” contains the time in seconds since the
start of a pumping test. The columns “W1” through “W5” contain the water table
drawdowns measured in the corresponding wells “W1” to “W5”,in meters below the
initial water table.</p>
<p>For example, the fourth pumping test, during which a discharge of Q = 313 m3/h
was measured in Well W5, resulted in the following drawdowns:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">drawdowns[[<span class="st">&quot;W5&quot;</span>]]</a></code></pre></div>
<pre><code>##    time.in.seconds   W5   W1   W2   W3   W4
## 1              600 0.73 0.00 0.00 0.01 0.04
## 2             1200 0.74 0.00 0.00 0.01 0.04
## 3             1800 0.75 0.00 0.00 0.01 0.06
## 4             2400 0.77 0.01 0.00 0.01 0.06
## 5             3600 0.78 0.01 0.00 0.02 0.07
## 6             5400 0.80 0.01 0.01 0.03 0.09
## 7             7200 0.82 0.02 0.01 0.04 0.10
## 8            10800 0.83 0.03 0.02 0.05 0.11
## 9            15000 0.85 0.03 0.03 0.06 0.13
## 10           21600 0.87 0.04 0.04 0.08 0.15
## 11           31200 0.89 0.05 0.05 0.09 0.16
## 12           44400 0.92 0.06 0.06 0.11 0.18
## 13           63600 0.93 0.07 0.07 0.12 0.20
## 14           90600 0.95 0.08 0.08 0.14 0.21
## 15          129600 0.96 0.09 0.09 0.15 0.23</code></pre>
<p>It seems as if the drawdowns reach a steady-state after a certain time. This can
be judged better by a diagram that can be produced in R by using the xyplot
function from the R-package “lattice”:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">lattice<span class="op">::</span><span class="kw">xyplot</span>(W1 <span class="op">+</span><span class="st"> </span>W2 <span class="op">+</span><span class="st"> </span>W3 <span class="op">+</span><span class="st"> </span>W4 <span class="op">+</span><span class="st"> </span>W5 <span class="op">~</span><span class="st"> </span>time.in.seconds, </a>
<a class="sourceLine" id="cb12-2" data-line-number="2">       <span class="dt">data =</span> drawdowns[[<span class="st">&quot;W5&quot;</span>]], </a>
<a class="sourceLine" id="cb12-3" data-line-number="3">       <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;g&quot;</span>), <span class="co"># (b)oth, dots and lines, and a (g)rid</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4">       <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">columns =</span> <span class="dv">5</span>), <span class="co"># legend arranged in five columns</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">       <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="op">-</span><span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">       <span class="dt">ylab=</span> <span class="st">&quot;Drawdown (m)&quot;</span>, <span class="co"># label of y-Axis</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">       <span class="dt">xlab=</span> <span class="st">&quot;Time in seconds since start of pumping in W5 (s)&quot;</span>) <span class="co"># label of y-Axis</span></a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="model-parameterisation" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Model parameterisation</h3>
<p>In a first step a WTAQ input file needs to be defined. This can be realised with
two different functions:</p>
<ul>
<li><p><code>wtConfigure()</code>: definition of WTAQ configuration within R</p></li>
<li><p><code>wtReadInputFile()</code>: importing of WTAQ configuration from existing WTAQ input
text file into R</p></li>
</ul>
<p>The WTAQ input file can be directly defined in R using the function <code>wtConfigure()</code>
and saved in the R object <code>wtaqConfiguration</code> (for a full description of all the
parameters that are accepted by the configuration functions, see:
<a href="kwbwtaq_ParameterTable.html">Parameter tables</a>).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">generalConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigureGeneral</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  ### title of the project (max. length 70 characters)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">title=</span><span class="st">&quot;Example well field, long-term pumping test of well 5&quot;</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  )</a>
<a class="sourceLine" id="cb13-5" data-line-number="5"></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">aquiferConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigureAquifer</span>(    </a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="dt">aqtype =</span> <span class="st">&quot;WATER TABLE&quot;</span>, <span class="co"># aquifer type</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">  <span class="dt">bb =</span> <span class="dv">10</span>,                <span class="co"># saturated aquifer thickness</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="dt">hkr =</span> <span class="fl">1E-03</span>,            <span class="co"># horizontal hydraulic conductivity</span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10">  <span class="dt">hkz =</span> <span class="fl">3.5E-05</span>,          <span class="co"># vertical hydraulic conductivity</span></a>
<a class="sourceLine" id="cb13-11" data-line-number="11">  <span class="dt">ss =</span> <span class="fl">1E-05</span>,             <span class="co"># specific storage</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">  <span class="dt">sy =</span> <span class="fl">0.05</span>               <span class="co"># specific yield</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14"></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">drainageConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigureDrainage</span>(</a>
<a class="sourceLine" id="cb13-16" data-line-number="16">  <span class="dt">idra =</span> <span class="dv">0</span> <span class="co"># = instantaneous drainage in unsaturated zone</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb13-18" data-line-number="18"></a>
<a class="sourceLine" id="cb13-19" data-line-number="19">timesConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigureTimes</span>(</a>
<a class="sourceLine" id="cb13-20" data-line-number="20">  <span class="dt">its =</span> <span class="dv">1</span> <span class="co"># = user-specified time-steps</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21">)</a></code></pre></div>
<p>In the following we will configure one pumping well and two observation wells
(for simplifying the tutorial we restrict ourselves to two instead of four
observation wells four which drawdown time series are available).</p>
<p>Since WTAQ allows to define time-series of measured drawdowns for each well,
the corresponding functions <code>wtConfigurePumpwell()</code> and <code>wtConfigureObservationWell()</code>,
that are described in the following, also allow to specify these measured drawdown
values. For this example, we want to use the drawdowns of the fourth pumping test,
provided in the example dataset <code>drawdowns</code>. We store it in a separate variable
<code>drawdowns5</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">drawdowns5 &lt;-<span class="st"> </span>drawdowns[[<span class="st">&quot;W5&quot;</span>]]</a></code></pre></div>
<p>Now we prepare some data frames (a table-like structure in R, defined by rows
and columns, see <code>?data.frame</code>) representing three drawdown time series, which
are measured at :</p>
<ul>
<li><p>the pumping well “PW” and</p></li>
<li><p>two different observation wells “OW1” and “OW4”.</p></li>
</ul>
<p>By doing this we simplify the programmig code that is used later on:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># the times of observations are the same for all wells:</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">times &lt;-<span class="st"> </span>drawdowns5<span class="op">$</span>time.in.seconds</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co"># observed drawdowns at the pumping well</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">observed.PW  &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">t =</span> times, <span class="dt">dd =</span> drawdowns5<span class="op">$</span>W5)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co"># observed drawdowns at the observation wells</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">observed.OW1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">t =</span> times, <span class="dt">dd =</span> drawdowns5<span class="op">$</span>W1)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">observed.OW4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">t =</span> times, <span class="dt">dd =</span> drawdowns5<span class="op">$</span>W4)</a></code></pre></div>
<p>Let’s start with the configuration of the pumping well:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">pumpwellConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigurePumpwell</span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  ### partially penetrating pumped well</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">ipws =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  ### finite diameter well</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  <span class="dt">ipwd =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  ### pumping rate of production well in (here: m3/s)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">qq =</span> <span class="fl">0.0869</span>, </a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  ### radius of pumped well-screen (here: meter) </a>
<a class="sourceLine" id="cb16-9" data-line-number="9">  <span class="dt">rw =</span> <span class="fl">1.5</span>, </a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  ### top of filter screen below initial water table (here: meter)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">  <span class="dt">zpd =</span> <span class="fl">0.4</span>, </a>
<a class="sourceLine" id="cb16-12" data-line-number="12">  ### bottom of filter screen below initial water table (here: meter)</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="dt">zpl =</span> <span class="fl">7.8</span>, </a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  ### well-bore skin parameter (dimensionless)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">  <span class="dt">sw =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb16-16" data-line-number="16">  ### data.frame with times and measured drawdown data in pumping well</a>
<a class="sourceLine" id="cb16-17" data-line-number="17">  <span class="dt">tspw =</span> observed.PW </a>
<a class="sourceLine" id="cb16-18" data-line-number="18">)</a></code></pre></div>
<p>Now, let’s define our first observation well:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">observationWell1 &lt;-<span class="st"> </span><span class="kw">wtConfigureObservationWell</span>(</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  ### name of observation well</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="dt">obname =</span> <span class="st">&quot;OW1&quot;</span>, </a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  ### distance from pumping well (here: meters)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="dt">r =</span> <span class="fl">309.5</span>, </a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  ### partially penetrating observation well</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="dt">iows =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  ### delayed response</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">  <span class="dt">idpr =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb17-10" data-line-number="10">  ### top of filter screen below initial water table (here: meters)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">  <span class="dt">z1 =</span> <span class="fl">1.8</span>, </a>
<a class="sourceLine" id="cb17-12" data-line-number="12">  ### bottom of filter screen below initial water table (here: meters)</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">  <span class="dt">z2 =</span> <span class="fl">7.5</span>, </a>
<a class="sourceLine" id="cb17-14" data-line-number="14">  ### inside radius of the observation well (here: meters)</a>
<a class="sourceLine" id="cb17-15" data-line-number="15">  <span class="dt">rp =</span> <span class="fl">1.5</span>, </a>
<a class="sourceLine" id="cb17-16" data-line-number="16">  ### data.frame with times and measured drawdown data in OW1</a>
<a class="sourceLine" id="cb17-17" data-line-number="17">  <span class="dt">tsobs=</span> observed.OW1 </a>
<a class="sourceLine" id="cb17-18" data-line-number="18">)</a></code></pre></div>
<p>In the same way, we define a second observation well “OW4”
(in a formally more compact way to save some space here):</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">observationWell4 &lt;-<span class="st"> </span><span class="kw">wtConfigureObservationWell</span>(<span class="dt">obname =</span> <span class="st">&quot;OW4&quot;</span>, <span class="dt">r =</span> <span class="fl">86.6</span>,</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  <span class="dt">iows =</span> <span class="dv">0</span>, <span class="dt">idpr =</span> <span class="dv">1</span>, <span class="dt">z1 =</span> <span class="fl">1.8</span>, <span class="dt">z2 =</span> <span class="fl">7.5</span>, <span class="dt">rp =</span> <span class="fl">1.5</span>, <span class="dt">tsobs =</span> observed.OW4)</a></code></pre></div>
<p>Out of these parts of configuration we can build one complete configuration by
using the function <code>wtConfigure()</code>. It returns a R list structure that represents
a model configuration containing all the necessary information that WTAQ
requires to perform a model run.
This information is saved in the R object <code>wtaqConfiguration</code> and will be
used for the following chapters of this tutorial.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">wtaqConfiguration &lt;-<span class="st"> </span><span class="kw">wtConfigure</span>(</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">  <span class="dt">general =</span> generalConfiguration,</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="dt">aquifer =</span> aquiferConfiguration, </a>
<a class="sourceLine" id="cb19-4" data-line-number="4">  <span class="dt">drainage =</span> drainageConfiguration, </a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  <span class="dt">times =</span> timesConfiguration, </a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  <span class="dt">solution =</span> <span class="kw">wtConfigureSolution</span>(),</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">  <span class="dt">pumpwell =</span> pumpwellConfiguration,</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">  <span class="dt">obswells =</span> <span class="kw">list</span>(observationWell4, </a>
<a class="sourceLine" id="cb19-9" data-line-number="9">                  observationWell1)</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">)</a></code></pre></div>
<div class="rmdtip">
<p>
<em>Alternatively it is possible to load WTAQ input text files diretly into R with the function <code>wtReadInputFile()</code> from an already existing WTAQ input text file, e.g.:</em>
</p>
</div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">inputFile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;example1.inp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;kwb.wtaq&quot;</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">wtaqConfiguration2 &lt;-<span class="st"> </span><span class="kw">wtReadInputFile</span>(inputFile)</a></code></pre></div>
<p><em>However, in this tutorial we just focus on the example that is stored in the R
object <code>wtaqConfiguration</code>.</em></p>
<p>For checking this model parameterisation it can be printed:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">wtaqConfiguration</a></code></pre></div>
<pre><code>## General
## - Title:  Example well field, long-term pumping test of well 5 
## - Format: DIMENSIONAL 
## 
## Aquifer
## - Type: WATER TABLE 
## - Thickness (bb) ............: 10.000000 (length)
## - Horiz. hydr. conduct. (hkr): 0.001000 (length/time)
## - Vert.  hydr. conduct. (hkz): 0.000035 (length/time)
## - Specific storage (ss) .....: 0.000010 (1/length)
## - Specific yield (sy) .......: 0.050000
## 
## Drainage
## - Type: Instantaneous drainage (idra = 0)
## 
## Times
## - Type: User-specified times (its = 1)
## 
## Solution
## - Type: de Hoog algorithm (isoln = 2)
## - Rel. err. for Newton-Raphson iter. (rerrnr) ...................: 0.000000
## - Rel. err. sought for accur. of the num. invers. (error) .......: 0.000100
## - Factor to determ. # terms in finite summations (ntms) .........: 30
## - # terms in summ. of Fourier series for inv. Lapl. transf. (nnn): 6
## - Method used to accelerate convergence of Fourier series .......: 3
## 
## Pumped Well (&quot;PW&quot;)
## - Type: Partially penetrating pumped well (ipws = 0)
## - Type of diameter: Finite diameter (ipwd = 1)
## - Pumping rate (qq) .......................................: 0.086900 (length^3/time)
## - Radius of screen (rw) ...................................: 1.500000 (length)
## - Inside radius where levels change during pumping (rc) ...: 1.500000 (length)
## - Top of aquifer/initial water table to screen top (zpd) ..: 0.400000 (length)
## - Top of aquifer/initial water table to screen bottom (zpl): 7.800000 (length)
## - Well-bore skin parameter (sw) ...........................: 0.000000 
## - Predefined Times (t)/drawdown measurements (dd):
##         t   dd
## 1     600 0.73
## 2    1200 0.74
## 3    1800 0.75
## 4    2400 0.77
## 5    3600 0.78
## 6    5400 0.80
## 7    7200 0.82
## 8   10800 0.83
## 9   15000 0.85
## 10  21600 0.87
## 11  31200 0.89
## 12  44400 0.92
## 13  63600 0.93
## 14  90600 0.95
## 15 129600 0.96
## 
## Observation Well &quot;OW4&quot;
## - Type: Partially penetrating observation well (iows = 0)
## - Delayed response: yes (idpr = 1)
## - Radial dist. from axis of pumped well to obs. well (r) .....: 86.600000 (length)
## - Top of aquifer/initial water table to screen top (z1) ......: 1.800000 (length)
## - Top of aquifer/initial water table to screen bottom (z2) ...: 7.500000 (length)
## - Inside radius of standpipe where levels change (rp) ........: 1.500000 (length)
## - Length of screened interval (xll) ..........................: 5.700000 (length)
## - Predefined Times (t)/drawdown measurements (dd):
##         t   dd
## 1     600 0.04
## 2    1200 0.04
## 3    1800 0.06
## 4    2400 0.06
## 5    3600 0.07
## 6    5400 0.09
## 7    7200 0.10
## 8   10800 0.11
## 9   15000 0.13
## 10  21600 0.15
## 11  31200 0.16
## 12  44400 0.18
## 13  63600 0.20
## 14  90600 0.21
## 15 129600 0.23
## 
## Observation Well &quot;OW1&quot;
## - Type: Partially penetrating observation well (iows = 0)
## - Delayed response: yes (idpr = 1)
## - Radial dist. from axis of pumped well to obs. well (r) .....: 309.500000 (length)
## - Top of aquifer/initial water table to screen top (z1) ......: 1.800000 (length)
## - Top of aquifer/initial water table to screen bottom (z2) ...: 7.500000 (length)
## - Inside radius of standpipe where levels change (rp) ........: 1.500000 (length)
## - Length of screened interval (xll) ..........................: 5.700000 (length)
## - Predefined Times (t)/drawdown measurements (dd):
##         t   dd
## 1     600 0.00
## 2    1200 0.00
## 3    1800 0.00
## 4    2400 0.01
## 5    3600 0.01
## 6    5400 0.01
## 7    7200 0.02
## 8   10800 0.03
## 9   15000 0.03
## 10  21600 0.04
## 11  31200 0.05
## 12  44400 0.06
## 13  63600 0.07
## 14  90600 0.08
## 15 129600 0.09</code></pre>
<p>and also graphically visualised with the function <code>wtPlotConfiguration()</code>, e.g.:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">wtPlotConfiguration</span>(wtaqConfiguration, <span class="dt">asp =</span> <span class="ot">NA</span>)</a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="model-run" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Model run</h3>
<p>For running WTAQ and saving the results in the R object <code>result</code> we just have do
use the function <code>wtRunConfiguration()</code> with our above defined model parameterisation
<code>wtaqConfiguration</code>:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">wtRunConfiguration</span>(wtaqConfiguration)</a></code></pre></div>
</div>
<div id="analysing-results" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Analysing results</h3>
<p>To print the results of the model run, that are stored in the object <code>result</code>
in the <strong>RStudio</strong> console we simply need to enter:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">result</a></code></pre></div>
<pre><code>##    WELL   TIME MEASDD    CALCDD  RELERR
## 3    PW    600   0.73 3.808e+00 -421.60
## 4    PW   1200   0.74 4.731e+00 -539.40
## 5    PW   1800   0.75 5.033e+00 -571.00
## 6    PW   2400   0.77 5.189e+00 -573.90
## 7    PW   3600   0.78 5.402e+00 -592.50
## 8    PW   5400   0.80 5.640e+00 -604.90
## 9    PW   7200   0.82 5.825e+00 -610.30
## 10   PW  10800   0.83 6.103e+00 -635.30
## 11   PW  15000   0.85 6.338e+00 -645.60
## 12   PW  21600   0.87 6.602e+00 -658.90
## 13   PW  31200   0.89 6.869e+00 -671.80
## 14   PW  44400   0.92 7.123e+00 -674.30
## 15   PW  63600   0.93 7.380e+00 -693.60
## 16   PW  90600   0.95 7.631e+00 -703.20
## 17   PW 129600   0.96 7.883e+00 -721.10
## 20  OW4    600   0.04 2.162e-02   45.94
## 21  OW4   1200   0.04 4.856e-02  -21.41
## 22  OW4   1800   0.06 6.812e-02  -13.53
## 23  OW4   2400   0.06 8.315e-02  -38.59
## 24  OW4   3600   0.07 1.086e-01  -55.15
## 25  OW4   5400   0.09 1.453e-01  -61.41
## 26  OW4   7200   0.10 1.826e-01  -82.61
## 27  OW4  10800   0.11 2.579e-01 -134.50
## 28  OW4  15000   0.13 3.440e-01 -164.60
## 29  OW4  21600   0.15 4.703e-01 -213.50
## 30  OW4  31200   0.16 6.307e-01 -294.20
## 31  OW4  44400   0.18 8.115e-01 -350.90
## 32  OW4  63600   0.20 1.016e+00 -408.10
## 33  OW4  90600   0.21 1.232e+00 -486.60
## 34  OW4 129600   0.23 1.460e+00 -534.60
## 37  OW1    600   0.00 1.659e-05      NA
## 38  OW1   1200   0.00 4.502e-05      NA
## 39  OW1   1800   0.00 7.374e-05      NA
## 40  OW1   2400   0.01 1.039e-04   98.96
## 41  OW1   3600   0.01 1.747e-04   98.25
## 42  OW1   5400   0.01 3.169e-04   96.83
## 43  OW1   7200   0.02 5.106e-04   97.45
## 44  OW1  10800   0.03 1.081e-03   96.40
## 45  OW1  15000   0.03 2.114e-03   92.95
## 46  OW1  21600   0.04 4.682e-03   88.30
## 47  OW1  31200   0.05 1.075e-02   78.49
## 48  OW1  44400   0.06 2.373e-02   60.45
## 49  OW1  63600   0.07 5.076e-02   27.49
## 50  OW1  90600   0.08 9.924e-02  -24.05
## 51  OW1 129600   0.09 1.775e-01  -97.28</code></pre>
<p>For plotting the results we can either use the function <code>wtPlotResult()</code> with
the parameter <code>plottype = &quot;w&quot;</code> to plot for each well measured (MEASDD) and
calculated (CALCDD) drawdowns in one plot:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">wtPlotResult</span>(result, </a>
<a class="sourceLine" id="cb27-2" data-line-number="2">             <span class="dt">plottype =</span> <span class="st">&quot;w&quot;</span>, </a>
<a class="sourceLine" id="cb27-3" data-line-number="3">             <span class="dt">main=</span><span class="st">&quot;Pumping test W5: model results without calibration&quot;</span>)</a></code></pre></div>
<pre><code>## Removing column &#39;RELERR&#39; from &#39;wtaqResult&#39;.</code></pre>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>or produce a plot that contains measured and calculated drawdowns for all wells
in two separate plots by setting the parameter <code>plottype = &quot;s&quot;</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">wtPlotResult</span>(result, </a>
<a class="sourceLine" id="cb29-2" data-line-number="2">             <span class="dt">plottype =</span> <span class="st">&quot;s&quot;</span>,</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">             <span class="dt">main=</span><span class="st">&quot;Pumping test W5: model results without calibration&quot;</span>)</a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<div id="model-calibration" class="section level3">
<h3><span class="header-section-number">3.1.5</span> Model calibration</h3>
<p>For this tutorial calibration is realised by using an automatised one-dimensional
optimisation approach for the following two model parameters, because these were
identified to be the most sensitive ones:</p>
<ul>
<li><p><a href="example-sessions.html#aquifer-characteristics-horizontal-hydraulic-conductivity-step-1">1. Step: Horizontal hydraulic aquifer conductivity (hkr): for calibrating the drawdown in the observation well</a></p></li>
<li><p><a href="example-sessions.html#well-characteristics-well-bore-skin-parameter-of-production-well-step-2">2. Step: Well-skin parameter: for calibrating production well drawdown</a></p></li>
</ul>
<p>The approach is valid because the calibration of the well-skin parameter (during
Step 2) has no impact on the observation well drawdowns (Step 1). However, it
needs to be stated that conditions could occur, where a better model fit could
be possible (especially if the mid-term drawdown data are not fitting well) in
case that both, vertical <code>hkz</code> and horizontal <code>hkr</code> hydraulic aquifer conductivity
are varied in tandem.</p>
<p>Within this tutorial we solve this one-dimensional optimisation problem by using:</p>
<ul>
<li><p>the build-in R function <code>optimise()</code> and</p></li>
<li><p>the Root-Mean-Square-Error (RMSE) as the only performance criteria for
evaluating the model fitness (i.e. comparision of calculated and measured drawdowns).</p></li>
</ul>
<p>For solving this optimisation (or: calibration) problem we define the R function
<code>calibrateModel()</code> which requires the following four input parameters:</p>
<ul>
<li><p><code>configuration</code>: a valid WTAQ input parameterisation (here: <code>wtaqConfiguration</code>)</p></li>
<li><p><code>wellPattern</code>: a regular expression or the well(s) names to be used for the
model fit evaluation (here: <code>OW4</code> or <code>PW</code>)</p></li>
<li><p><code>parameterName</code>: name of the WTAQ parameter that should be calibrated (here: <code>hkr</code> or <code>sw</code>)</p></li>
<li><p><code>parameterRange</code>: allowed value range for calibration parameter (e.g.
<code>c(0.0001, 0.1)</code> for parameter <code>hkr</code>)</p></li>
</ul>
<p>Firstly this function - and its three dependent helper functions <code>modelFitness()</code>,
<code>modelFitnessAggregated</code> and <code>fitnessAdaptedModelConfiguration()</code> - need to be
loaded in R by running the following code:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">### Package for gof function</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">library</span>(hydroGOF)</a></code></pre></div>
<pre><code>## Warning: package &#39;hydroGOF&#39; was built under R version 3.5.1</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## Warning: package &#39;zoo&#39; was built under R version 3.5.1</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="co"># modelFitness(): called by function modelFitnessAggregated()</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2">modelFitness &lt;-<span class="st"> </span><span class="cf">function</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3">(</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  wtaqResult, </a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  wellPattern</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">  {</a>
<a class="sourceLine" id="cb36-8" data-line-number="8">  subResult &lt;-<span class="st"> </span>wtaqResult[<span class="kw">grep</span>(<span class="dt">pattern =</span> wellPattern, wtaqResult<span class="op">$</span>WELL),]</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb36-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb36-11" data-line-number="11">  fitness &lt;-<span class="st"> </span><span class="kw">t</span>(hydroGOF<span class="op">::</span><span class="kw">gof</span>(<span class="dt">sim =</span> subResult<span class="op">$</span>MEASDD, <span class="dt">obs =</span> subResult<span class="op">$</span>CALCDD, <span class="dt">digits =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb36-13" data-line-number="13">  <span class="kw">colnames</span>(fitness) &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot; %&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="kw">colnames</span>(fitness))</a>
<a class="sourceLine" id="cb36-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb36-15" data-line-number="15">  ### data.frame with plenty of performance indicators: e.g. RMSE, NSE, R2</a>
<a class="sourceLine" id="cb36-16" data-line-number="16">  <span class="kw">as.data.frame</span>(fitness)</a>
<a class="sourceLine" id="cb36-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb36-18" data-line-number="18"></a>
<a class="sourceLine" id="cb36-19" data-line-number="19"><span class="co"># modelFitnessAggregated: called by function fitnessAdaptedModelConfiguration()</span></a>
<a class="sourceLine" id="cb36-20" data-line-number="20">modelFitnessAggregated &lt;-<span class="st"> </span><span class="cf">function</span> </a>
<a class="sourceLine" id="cb36-21" data-line-number="21">(</a>
<a class="sourceLine" id="cb36-22" data-line-number="22">  wtaqResult, </a>
<a class="sourceLine" id="cb36-23" data-line-number="23">  wellPattern</a>
<a class="sourceLine" id="cb36-24" data-line-number="24">  )</a>
<a class="sourceLine" id="cb36-25" data-line-number="25">  {</a>
<a class="sourceLine" id="cb36-26" data-line-number="26">  fitness &lt;-<span class="st"> </span><span class="kw">modelFitness</span>(wtaqResult, wellPattern)</a>
<a class="sourceLine" id="cb36-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb36-28" data-line-number="28">  ### Objective function for the performance criteria that is minimised, here:</a>
<a class="sourceLine" id="cb36-29" data-line-number="29">  fitness<span class="op">$</span>RMSE </a>
<a class="sourceLine" id="cb36-30" data-line-number="30">  }</a>
<a class="sourceLine" id="cb36-31" data-line-number="31"></a>
<a class="sourceLine" id="cb36-32" data-line-number="32"><span class="co"># fitnessAdaptedModelConfiguration: called by function calibrateModel()</span></a>
<a class="sourceLine" id="cb36-33" data-line-number="33">fitnessAdaptedModelConfiguration &lt;-<span class="st"> </span><span class="cf">function</span> </a>
<a class="sourceLine" id="cb36-34" data-line-number="34">(</a>
<a class="sourceLine" id="cb36-35" data-line-number="35">  parameterValue, parameterName, configuration, wellPattern </a>
<a class="sourceLine" id="cb36-36" data-line-number="36">  ) </a>
<a class="sourceLine" id="cb36-37" data-line-number="37">  {</a>
<a class="sourceLine" id="cb36-38" data-line-number="38">  configuration &lt;-<span class="st"> </span><span class="kw">wtSetParameter</span>(configuration, parameterName, parameterValue)</a>
<a class="sourceLine" id="cb36-39" data-line-number="39">  </a>
<a class="sourceLine" id="cb36-40" data-line-number="40">  wtaqResult &lt;-<span class="st"> </span><span class="kw">wtRunConfiguration</span>(configuration)</a>
<a class="sourceLine" id="cb36-41" data-line-number="41">  </a>
<a class="sourceLine" id="cb36-42" data-line-number="42">  <span class="kw">modelFitnessAggregated</span>(wtaqResult, wellPattern)</a>
<a class="sourceLine" id="cb36-43" data-line-number="43">  }</a>
<a class="sourceLine" id="cb36-44" data-line-number="44"></a>
<a class="sourceLine" id="cb36-45" data-line-number="45"><span class="co">#calibrateModel()</span></a>
<a class="sourceLine" id="cb36-46" data-line-number="46">calibrateModel &lt;-<span class="st"> </span><span class="cf">function</span> (</a>
<a class="sourceLine" id="cb36-47" data-line-number="47">    ### WTAQ parameterisation, e.g. as retrieved by wtConfigure()</a>
<a class="sourceLine" id="cb36-48" data-line-number="48">    configuration,</a>
<a class="sourceLine" id="cb36-49" data-line-number="49">    ### regular expression or name of well(s) to be used for calibration: e.g. &quot;OW4&quot;</a>
<a class="sourceLine" id="cb36-50" data-line-number="50">    wellPattern,</a>
<a class="sourceLine" id="cb36-51" data-line-number="51">    ### name of ONE WTAQ parameter to be calibrated: e.g. `hkr`, `sw`</a>
<a class="sourceLine" id="cb36-52" data-line-number="52">    parameterName,</a>
<a class="sourceLine" id="cb36-53" data-line-number="53">    ### min/max range of possible calibration parameter values </a>
<a class="sourceLine" id="cb36-54" data-line-number="54">    parameterRange </a>
<a class="sourceLine" id="cb36-55" data-line-number="55">    ) </a>
<a class="sourceLine" id="cb36-56" data-line-number="56">    {</a>
<a class="sourceLine" id="cb36-57" data-line-number="57">    optResults &lt;-<span class="st"> </span><span class="kw">optimise</span>(</a>
<a class="sourceLine" id="cb36-58" data-line-number="58">      <span class="dt">f =</span> fitnessAdaptedModelConfiguration, </a>
<a class="sourceLine" id="cb36-59" data-line-number="59">      <span class="dt">interval =</span> parameterRange,</a>
<a class="sourceLine" id="cb36-60" data-line-number="60">      <span class="dt">parameterName =</span> parameterName, </a>
<a class="sourceLine" id="cb36-61" data-line-number="61">      <span class="dt">configuration =</span> configuration, </a>
<a class="sourceLine" id="cb36-62" data-line-number="62">      <span class="dt">wellPattern =</span> wellPattern )</a>
<a class="sourceLine" id="cb36-63" data-line-number="63">    </a>
<a class="sourceLine" id="cb36-64" data-line-number="64">    ### Save calibrated WTAQ configuration: </a>
<a class="sourceLine" id="cb36-65" data-line-number="65">    wtaqConfigurationCalibrated &lt;-<span class="st"> </span><span class="kw">wtSetParameter</span>(</a>
<a class="sourceLine" id="cb36-66" data-line-number="66">      <span class="dt">configuration =</span> configuration, </a>
<a class="sourceLine" id="cb36-67" data-line-number="67">      <span class="dt">parameterName =</span> parameterName, </a>
<a class="sourceLine" id="cb36-68" data-line-number="68">      <span class="dt">parameterValue =</span> optResults<span class="op">$</span>minimum)</a>
<a class="sourceLine" id="cb36-69" data-line-number="69">    </a>
<a class="sourceLine" id="cb36-70" data-line-number="70">    ### Save optimisation results in list</a>
<a class="sourceLine" id="cb36-71" data-line-number="71">    <span class="kw">list</span>(<span class="dt">parameterName=</span>parameterName, </a>
<a class="sourceLine" id="cb36-72" data-line-number="72">         <span class="dt">wellPattern=</span>wellPattern,</a>
<a class="sourceLine" id="cb36-73" data-line-number="73">         <span class="dt">optimalParameterValue=</span>optResults<span class="op">$</span>minimum, </a>
<a class="sourceLine" id="cb36-74" data-line-number="74">         <span class="dt">minimalPerformanceValue=</span>optResults<span class="op">$</span>objective,</a>
<a class="sourceLine" id="cb36-75" data-line-number="75">         <span class="dt">wtaqConfig=</span>wtaqConfigurationCalibrated</a>
<a class="sourceLine" id="cb36-76" data-line-number="76">         )</a>
<a class="sourceLine" id="cb36-77" data-line-number="77">    </a>
<a class="sourceLine" id="cb36-78" data-line-number="78">    }</a></code></pre></div>
<div id="aquifer-characteristics-horizontal-hydraulic-conductivity-step-1" class="section level4">
<h4><span class="header-section-number">3.1.5.1</span> Aquifer characteristics: horizontal hydraulic conductivity (Step 1)</h4>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="co"># 1.Step: Calibrate aquifer characteristics &#39;hkr&#39; for OW4-------------------------------</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"></a>
<a class="sourceLine" id="cb37-3" data-line-number="3">calibratedAquifer &lt;-<span class="st"> </span><span class="kw">calibrateModel</span>(</a>
<a class="sourceLine" id="cb37-4" data-line-number="4">  ### reference wtaq configuration</a>
<a class="sourceLine" id="cb37-5" data-line-number="5">  <span class="dt">configuration =</span> wtaqConfiguration, </a>
<a class="sourceLine" id="cb37-6" data-line-number="6">  ### calibrate hydraulic aquifer conductivity</a>
<a class="sourceLine" id="cb37-7" data-line-number="7">  <span class="dt">parameterName =</span> <span class="st">&quot;hkr&quot;</span>,  </a>
<a class="sourceLine" id="cb37-8" data-line-number="8">  ### &#39;hkr&#39; is within 0.0001 - 0.1 m/s</a>
<a class="sourceLine" id="cb37-9" data-line-number="9">  <span class="dt">parameterRange =</span> <span class="kw">c</span>(<span class="fl">0.0001</span>, <span class="fl">0.1</span>), </a>
<a class="sourceLine" id="cb37-10" data-line-number="10">  ### only use drawdown time-series of OW4 for calibration </a>
<a class="sourceLine" id="cb37-11" data-line-number="11">  <span class="dt">wellPattern =</span> <span class="st">&quot;OW4&quot;</span> </a>
<a class="sourceLine" id="cb37-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb37-13" data-line-number="13"></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"></a>
<a class="sourceLine" id="cb37-15" data-line-number="15">### Plot the drawdowns with calibrated aquifer characteristics:</a>
<a class="sourceLine" id="cb37-16" data-line-number="16"><span class="kw">wtPlotResult</span>(<span class="dt">wtaqResult =</span> <span class="kw">wtRunConfiguration</span>(</a>
<a class="sourceLine" id="cb37-17" data-line-number="17">  <span class="dt">configuration =</span> calibratedAquifer<span class="op">$</span>wtaqConfig),</a>
<a class="sourceLine" id="cb37-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb37-19" data-line-number="19">  <span class="dt">main =</span> <span class="kw">sprintf</span>(<span class="st">&quot;Optimal value of parameter &#39;%s&#39; for %s: %0.4f m/s&quot;</span>, </a>
<a class="sourceLine" id="cb37-20" data-line-number="20">                 calibratedAquifer<span class="op">$</span>parameterName, </a>
<a class="sourceLine" id="cb37-21" data-line-number="21">                 calibratedAquifer<span class="op">$</span>wellPattern, </a>
<a class="sourceLine" id="cb37-22" data-line-number="22">                 calibratedAquifer<span class="op">$</span>optimalParameterValue),</a>
<a class="sourceLine" id="cb37-23" data-line-number="23">  <span class="dt">plottype =</span> <span class="st">&quot;w&quot;</span>)</a></code></pre></div>
<pre><code>## Removing column &#39;RELERR&#39; from &#39;wtaqResult&#39;.</code></pre>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-29-1.png" width="672" />
After this step observed and measured drawdowns fit nearly perfectly for the
calibrated observation well “OW4” only by setting the <strong>hkr</strong> to <strong>0.0148366</strong> (m/s) , but still the drawdown in the production well
“PW” is underestimated (because it is still assumed that here are no “well losses”).</p>
<p>Thus the production well characteristics (i.e. the well-skin parameter <code>sw</code>) need to be
calibrated in a next step.</p>
</div>
<div id="well-characteristics-well-bore-skin-parameter-of-production-well-step-2" class="section level4">
<h4><span class="header-section-number">3.1.5.2</span> Well characteristics: well-bore skin parameter of production well (Step 2)</h4>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co">#2.Step: Calibrate well-bore skin parameter &#39;sw&#39; for PW-------------------------------</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2">calibratedAquiferAndWellSkin &lt;-<span class="st"> </span><span class="kw">calibrateModel</span>(</a>
<a class="sourceLine" id="cb39-3" data-line-number="3">  #### WTAQ configuration with calibrated aquifer (Step1)</a>
<a class="sourceLine" id="cb39-4" data-line-number="4">  <span class="dt">configuration =</span> calibratedAquifer<span class="op">$</span>wtaqConfig,</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">  ### calibrate well-bore skin parameter</a>
<a class="sourceLine" id="cb39-6" data-line-number="6">  <span class="dt">parameterName =</span> <span class="st">&quot;sw&quot;</span>, </a>
<a class="sourceLine" id="cb39-7" data-line-number="7">  ### &#39;sw&#39; within 0 - 100 (dimensionless)</a>
<a class="sourceLine" id="cb39-8" data-line-number="8">  <span class="dt">parameterRange =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </a>
<a class="sourceLine" id="cb39-9" data-line-number="9">  ### only use drawdown time-series of PW for calibration </a>
<a class="sourceLine" id="cb39-10" data-line-number="10">  <span class="dt">wellPattern =</span> <span class="st">&quot;PW&quot;</span>  </a>
<a class="sourceLine" id="cb39-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb39-12" data-line-number="12"></a>
<a class="sourceLine" id="cb39-13" data-line-number="13">### Plot the drawdowns with calibrated aquifer &amp; well-bore skin characteristics:</a>
<a class="sourceLine" id="cb39-14" data-line-number="14"><span class="kw">wtPlotResult</span>(<span class="dt">wtaqResult =</span> <span class="kw">wtRunConfiguration</span>(</a>
<a class="sourceLine" id="cb39-15" data-line-number="15">  <span class="dt">configuration =</span> calibratedAquiferAndWellSkin<span class="op">$</span>wtaqConfig,</a>
<a class="sourceLine" id="cb39-16" data-line-number="16">  ),</a>
<a class="sourceLine" id="cb39-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb39-18" data-line-number="18">  <span class="dt">main =</span> <span class="kw">sprintf</span>(<span class="st">&quot;Optimal value of parameter &#39;%s&#39; for %s: %2.4f (dimensionless)&quot;</span>, </a>
<a class="sourceLine" id="cb39-19" data-line-number="19">                 calibratedAquiferAndWellSkin<span class="op">$</span>parameterName, </a>
<a class="sourceLine" id="cb39-20" data-line-number="20">                 calibratedAquiferAndWellSkin<span class="op">$</span>wellPattern, </a>
<a class="sourceLine" id="cb39-21" data-line-number="21">                 calibratedAquiferAndWellSkin<span class="op">$</span>optimalParameterValue),</a>
<a class="sourceLine" id="cb39-22" data-line-number="22">  <span class="dt">plottype =</span> <span class="st">&quot;w&quot;</span>)</a></code></pre></div>
<pre><code>## Removing column &#39;RELERR&#39; from &#39;wtaqResult&#39;.</code></pre>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>By calibrating the well-skin parameter <strong>sw</strong> to <strong>2.0150393</strong> the drawdown in the production well “PW” now also fits nearly perfectly the
observed drawdown values, without impacting the fit for the observation wells.</p>
<div class="rmdimportant">
<p>
<em>There might be cases where the calibration results by following the methodology defined above is not satisfying. This can be possibly solved by calibrating multiple parameters in parallel (e.g. horizontal <code>hkr</code> and vertical hydraulic aquifer conductivity <code>hkz</code>). For this a more complex algorithm (e.g. build-in R function <code>optim()</code>), which is able to solve multi-dimenional optimisation problems, might be usefull. However, this goes beyond the scope of this tutorial.</em>
</p>
</div>
</div>
</div>
</div>
<div id="level-2-multiple-pumping-wells" class="section level2">
<h2><span class="header-section-number">3.2</span> Level 2: Multiple pumping wells</h2>
<div class="rmdwarning">
<p>
<em>For performing this example session it is required to perform all steps of the <a href="example-sessions.html#level-1-one-pumping-well">Level 1: one pumping well</a> example session first, because this example session requires some data of the <a href="example-sessions.html#level-1-one-pumping-well">Level 1: one pumping well</a> example</em>
</p>
</div>
<p>One challenge of using WTAQ for multiple wells is that the drawdown simulation
for each model run is limited to:</p>
<ul>
<li><p>one active production well and</p></li>
<li><p>up to 25 observation wells</p></li>
</ul>
<p>This means that the model parameterisation for the pumping (e.g. pumping rate)
and observation wells (e.g. distance to pumping well) needs to be
adapted for each model run manually by using the <strong>Level 1</strong> function (see: <a href="example-sessions.html#level-1-one-pumping-well">Level 1: one pumping well</a> example).</p>
<p>For avoiding such time consuming task additional <strong>Level 2</strong> functions were developed
and included in the <em>kwb.wtaq</em> package that simplify using WTAQ on the well-field scale.
The usage of these functions is described in the following:</p>
<div id="model-parameterisation-1" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Model parameterisation</h3>
<div id="well-field" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Well field</h4>
<p>In a first step the well field is defined, by creating a R object <code>owWellfieldConf</code>
that contains the following properties for each well, i.e.:</p>
<ul>
<li><p>Location <code>x</code>, <code>y</code>,</p></li>
<li><p>Well diameter <code>r</code>,</p></li>
<li><p>Depth of filter screen top <code>z1</code> and bottom <code>z2</code> below initial groundwater level</p></li>
<li><p>Well-skin parameter <code>sw</code></p></li>
</ul>
<p>For <strong>all</strong> production wells the well-skin parameter <code>sw</code> is set to <code>wellSkin</code>,
because this value achieved the best-model fit during <a href="example-sessions.html#well-characteristics-well-bore-skin-parameter-of-production-well-step-2">calibration for W5</a></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">### Well-skin parameter from calibration of W5 for all wells of the well field </a>
<a class="sourceLine" id="cb41-2" data-line-number="2">wellSkin &lt;-<span class="st"> </span>calibratedAquiferAndWellSkin<span class="op">$</span>optimalParameterValue</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="kw">sprintf</span>(<span class="st">&quot;Well-skin parameter value: %2.6f (dimensionless)&quot;</span>, wellSkin)</a></code></pre></div>
<pre><code>## [1] &quot;Well-skin parameter value: 2.015039 (dimensionless)&quot;</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="co"># Example well field configuration with 5 wells</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2">owWellfieldConf &lt;-<span class="st"> </span><span class="kw">rbind</span>(  </a>
<a class="sourceLine" id="cb43-3" data-line-number="3">  </a>
<a class="sourceLine" id="cb43-4" data-line-number="4">  <span class="kw">owConfigureWell</span>(</a>
<a class="sourceLine" id="cb43-5" data-line-number="5">    <span class="dt">wellName =</span> <span class="st">&quot;W1&quot;</span>, <span class="dt">x =</span> <span class="fl">807679.64</span>, <span class="dt">y =</span> <span class="fl">2091015.29</span>, </a>
<a class="sourceLine" id="cb43-6" data-line-number="6">    <span class="dt">r =</span> <span class="fl">1.5</span>, <span class="dt">z1 =</span> <span class="dv">2</span>, <span class="dt">z2 =</span> <span class="dv">4</span>, <span class="dt">sw =</span> wellSkin),  </a>
<a class="sourceLine" id="cb43-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb43-8" data-line-number="8">  <span class="kw">owConfigureWell</span>(</a>
<a class="sourceLine" id="cb43-9" data-line-number="9">    <span class="dt">wellName =</span> <span class="st">&quot;W2&quot;</span>, <span class="dt">x =</span> <span class="fl">807608.66</span>, <span class="dt">y =</span> <span class="fl">2091018.51</span>, </a>
<a class="sourceLine" id="cb43-10" data-line-number="10">    <span class="dt">r =</span> <span class="fl">1.7</span>, <span class="dt">z1 =</span> <span class="fl">4.2</span>, <span class="dt">z2 =</span> <span class="dv">7</span>, <span class="dt">sw =</span> wellSkin),</a>
<a class="sourceLine" id="cb43-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb43-12" data-line-number="12">  <span class="kw">owConfigureWell</span>(</a>
<a class="sourceLine" id="cb43-13" data-line-number="13">    <span class="dt">wellName =</span> <span class="st">&quot;W3&quot;</span>, <span class="dt">x =</span> <span class="fl">807558.27</span>, <span class="dt">y =</span> <span class="fl">2091090.30</span>, </a>
<a class="sourceLine" id="cb43-14" data-line-number="14">    <span class="dt">r =</span> <span class="fl">1.5</span>, <span class="dt">z1 =</span> <span class="fl">1.8</span>, <span class="dt">z2 =</span> <span class="dv">8</span>, <span class="dt">sw =</span> wellSkin),</a>
<a class="sourceLine" id="cb43-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb43-16" data-line-number="16">  <span class="kw">owConfigureWell</span>(</a>
<a class="sourceLine" id="cb43-17" data-line-number="17">    <span class="dt">wellName =</span> <span class="st">&quot;W4&quot;</span>, <span class="dt">x =</span> <span class="fl">807509.29</span>, <span class="dt">y =</span>  <span class="fl">2091161.80</span>, </a>
<a class="sourceLine" id="cb43-18" data-line-number="18">    <span class="dt">r =</span> <span class="fl">1.5</span>, <span class="dt">z1 =</span> <span class="fl">1.8</span>, <span class="dt">z2 =</span> <span class="fl">7.5</span>, <span class="dt">sw =</span> wellSkin),</a>
<a class="sourceLine" id="cb43-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb43-20" data-line-number="20">  <span class="kw">owConfigureWell</span>(</a>
<a class="sourceLine" id="cb43-21" data-line-number="21">    <span class="dt">wellName =</span> <span class="st">&quot;W5&quot;</span>, <span class="dt">x =</span> <span class="fl">807458.95</span>, <span class="dt">y =</span>  <span class="fl">2091232.26</span>, </a>
<a class="sourceLine" id="cb43-22" data-line-number="22">    <span class="dt">r =</span> <span class="fl">1.5</span>, <span class="dt">z1 =</span> <span class="fl">0.4</span>, <span class="dt">z2 =</span> <span class="fl">7.8</span>, <span class="dt">sw =</span> wellSkin))</a></code></pre></div>
<p>rmdimportant</p>
<p><em>On the <strong>Level 2</strong> function level it is now not necessary to define well distances
(this was required in the <a href="example-sessions.html#model-parameterisation">Level 1: one pumping well example</a>.
The well distances will be set later automatically for each model run based on
both, the <code>x</code> <code>y</code> coordinates:</em></p>
<pre><code>## Well distance matrix table:</code></pre>
<pre><code>##       W1    W2    W3    W4    W5
## W1        71.1 142.7 224.7 309.5
## W2  71.1        87.7 174.4 261.0
## W3 142.7  87.7        86.7 173.3
## W4 224.7 174.4  86.7        86.6
## W5 309.5 261.0 173.3  86.6</code></pre>
<p><em>and on the information which well is operating. For example column “W2” is used
if the pumping Well is “W2”</em></p>
</div>
<div id="basic-model-parameterisation" class="section level4">
<h4><span class="header-section-number">3.2.1.2</span> Basic model parameterisation</h4>
<p>In a next step we define we use the <strong>Level 2</strong> function <code>owConfigure()</code> to
prepare the constant parts of the WTAQ configuration parameterisation (<code>wellfield</code>,
<code>aquifer</code> and <code>drainage</code>) and store them in the object <code>owConf</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># Create constant components of WTAQ configuration</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">owConf &lt;-<span class="st"> </span><span class="kw">owConfigure</span>(<span class="dt">wellfield =</span> owWellfieldConf,</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">                      <span class="dt">aquifer =</span> calibratedAquiferAndWellSkin<span class="op">$</span>wtaqConfig<span class="op">$</span>aquifer,</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">                      <span class="dt">drainage =</span> <span class="kw">wtConfigureDrainage</span>(<span class="dt">idra =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb46-5" data-line-number="5">                     )</a></code></pre></div>
<div class="rmdtip">
<p>
<em>For the parameter <code>aquifer</code> we simply use the calibrated parameter setting, that we obtained after the <a href="example-sessions.html#model-calibration">Level 1 model calibration</a>, which is stored in the R object:</em>
</p>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">calibratedAquiferAndWellSkin<span class="op">$</span>wtaqConfig<span class="op">$</span>aquifer</a></code></pre></div>
<pre><code>## $aqtype
## [1] &quot;WATER TABLE&quot;
## 
## $bb
## [1] 10
## 
## $hkr
## [1] 0.01483664
## 
## $hkz
## [1] 3.5e-05
## 
## $ss
## [1] 1e-05
## 
## $sy
## [1] 0.05</code></pre>
<p>The well field configuration can be plotted with the function <code>owPlotConfiguration()</code>
(top view &amp; side view). By setting the parameter <code>referenceWell=1</code> the Well 1
is selected as reference well for plotting:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">owPlotConfiguration</span>(owConf,  <span class="dt">referenceWell =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-38-1.png" width="960" /></p>
</div>
<div id="time-varying-model-parameteristion" class="section level4">
<h4><span class="header-section-number">3.2.1.3</span> Time-varying model parameteristion</h4>
<p>The time-variant model parameterisation contains:</p>
<ul>
<li><p>the pumping rates (<code>pumpingRates</code>) of each well (here: defined in <code>owWellfieldConf</code>) and</p></li>
<li><p>the times for which the drawdowns should be calculated (<code>timesForDDcalculation</code>)</p></li>
</ul>
<p>These are defined in the following code:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="co"># pumping rates of well W1 to W5</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2">pumpingRates &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.069</span>, <span class="fl">0.089</span>, <span class="fl">0.088</span>, <span class="fl">0.087</span>, <span class="fl">0.086</span>) </a>
<a class="sourceLine" id="cb50-3" data-line-number="3"></a>
<a class="sourceLine" id="cb50-4" data-line-number="4">### user-specified times</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">timesForDDcalculation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">60</span>,<span class="dv">600</span>,<span class="dv">1200</span>, <span class="dv">2400</span>,<span class="dv">3600</span>, </a>
<a class="sourceLine" id="cb50-6" data-line-number="6">                           <span class="dv">10000</span>, <span class="dv">50000</span>, <span class="dv">100000</span>, <span class="dv">300000</span>) </a></code></pre></div>
</div>
</div>
<div id="model-run-1" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Model run</h3>
<p>Now we have all parts for parameterising WTAQ and calulating the drawdowns easily
on the well field scale (i.e. running WTAQ multiple times in the background).</p>
<p>For this we use the function <code>owGetDrawdowns()</code> with the following parameters:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">ddlist &lt;-<span class="st"> </span><span class="kw">owGetDrawdowns</span>(</a>
<a class="sourceLine" id="cb51-2" data-line-number="2">  <span class="dt">owConf=</span>owConf, </a>
<a class="sourceLine" id="cb51-3" data-line-number="3">  <span class="dt">Q =</span> pumpingRates, </a>
<a class="sourceLine" id="cb51-4" data-line-number="4">  <span class="dt">times =</span> timesForDDcalculation,</a>
<a class="sourceLine" id="cb51-5" data-line-number="5">  ### required for using the function wtPlotResults()</a>
<a class="sourceLine" id="cb51-6" data-line-number="6">  <span class="dt">to.matrix=</span><span class="ot">FALSE</span> </a>
<a class="sourceLine" id="cb51-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb51-8" data-line-number="8"></a>
<a class="sourceLine" id="cb51-9" data-line-number="9">ddmatrix&lt;-<span class="st"> </span><span class="kw">owGetDrawdowns</span>(</a>
<a class="sourceLine" id="cb51-10" data-line-number="10">  <span class="dt">owConf=</span>owConf, </a>
<a class="sourceLine" id="cb51-11" data-line-number="11">  <span class="dt">Q =</span> pumpingRates, </a>
<a class="sourceLine" id="cb51-12" data-line-number="12">  <span class="dt">times =</span> timesForDDcalculation,</a>
<a class="sourceLine" id="cb51-13" data-line-number="13">  ### saves results in &quot;matrix&quot; format: required for function owSuperposeDrawdowns()</a>
<a class="sourceLine" id="cb51-14" data-line-number="14">  <span class="dt">to.matrix=</span><span class="ot">TRUE</span> </a>
<a class="sourceLine" id="cb51-15" data-line-number="15">  )</a></code></pre></div>
<p>The switch <code>to.matrix=TRUE</code> is required in case one would like to calculate the
total drawdown in each well including well interference with the function <code>owSuperposeDrawdowns()</code>:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">drawdownsWithWellInterference &lt;-<span class="st"> </span><span class="kw">owSuperposeDrawdowns</span>(<span class="dt">drawdownList =</span> ddmatrix)</a></code></pre></div>
</div>
<div id="analysing-results-1" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Analysing results</h3>
<p><strong>Quantifying the impact of well interference</strong></p>
<p>Finally the modelling results can be analysed. For example it is possible to
quantify the additional drawdown due to well interference, e.g. for “W1”:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">myWell &lt;-<span class="st"> &quot;W1&quot;</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2">DD_inProductionWell_withInterference &lt;-<span class="st"> </span>drawdownsWithWellInterference[,myWell] </a>
<a class="sourceLine" id="cb53-3" data-line-number="3">DD_inProductionWell_withoutInterference &lt;-<span class="st"> </span>ddmatrix[[myWell]][,myWell]</a>
<a class="sourceLine" id="cb53-4" data-line-number="4">diffDrawdown &lt;-<span class="st"> </span>DD_inProductionWell_withInterference<span class="op">-</span>DD_inProductionWell_withoutInterference</a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="kw">data.frame</span>(<span class="dt">time.in.seconds=</span>drawdownsWithWellInterference[,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">      <span class="dt">additionalDrawdown.due.to.wellInterference.in.meter=</span>diffDrawdown)</a></code></pre></div>
<pre><code>##    time.in.seconds additionalDrawdown.due.to.wellInterference.in.meter
## 1                1                                         0.000000000
## 2                5                                         0.000016160
## 3               10                                         0.000116362
## 4               30                                         0.001717690
## 5               60                                         0.007218800
## 6              600                                         0.101305000
## 7             1200                                         0.119617000
## 8             2400                                         0.140303000
## 9             3600                                         0.159315000
## 10           10000                                         0.242770000
## 11           50000                                         0.483100000
## 12          100000                                         0.607290000
## 13          300000                                         0.810100000</code></pre>
<p><strong>Plotting of well drawdowns (without well interference):</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="cf">for</span> (wellName <span class="cf">in</span> owWellfieldConf<span class="op">$</span>wellName)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb55-3" data-line-number="3">  index &lt;-<span class="st"> </span><span class="kw">which</span>(owWellfieldConf<span class="op">$</span>wellName<span class="op">==</span>wellName)</a>
<a class="sourceLine" id="cb55-4" data-line-number="4"> wellQ &lt;-<span class="st"> </span>pumpingRates[index]</a>
<a class="sourceLine" id="cb55-5" data-line-number="5"> <span class="cf">if</span> (wellQ <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb55-6" data-line-number="6"> {</a>
<a class="sourceLine" id="cb55-7" data-line-number="7">  <span class="kw">wtPlotResult</span>(<span class="dt">wtaqResult =</span> ddlist[[wellName]], </a>
<a class="sourceLine" id="cb55-8" data-line-number="8">               <span class="dt">plottype =</span> <span class="st">&quot;s&quot;</span>, </a>
<a class="sourceLine" id="cb55-9" data-line-number="9">               <span class="dt">ylab =</span> <span class="st">&quot;Drawdown (m)&quot;</span>,</a>
<a class="sourceLine" id="cb55-10" data-line-number="10">               <span class="dt">xlab =</span> <span class="st">&quot;Time in seconds since start of pumping (s)&quot;</span>,</a>
<a class="sourceLine" id="cb55-11" data-line-number="11">               <span class="dt">main =</span> <span class="kw">sprintf</span>(<span class="st">&quot;Pumping well: %s (Q: %3.1f m3/h)&quot;</span>, </a>
<a class="sourceLine" id="cb55-12" data-line-number="12">                              wellName,                                   </a>
<a class="sourceLine" id="cb55-13" data-line-number="13">                              wellQ<span class="op">*</span><span class="dv">3600</span>))</a>
<a class="sourceLine" id="cb55-14" data-line-number="14"> }</a>
<a class="sourceLine" id="cb55-15" data-line-number="15">}</a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-43-1.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-43-2.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-43-3.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-43-4.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-43-5.png" width="672" /></p>
<p><strong>Plotting of well drawdowns (with well interference):</strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">plotWellInterference &lt;-<span class="st"> </span><span class="cf">function</span>(wellName, <span class="dt">Q=</span><span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb56-3" data-line-number="3">  <span class="cf">if</span> (<span class="kw">is.null</span>(Q)) {</a>
<a class="sourceLine" id="cb56-4" data-line-number="4">    label &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s &quot;</span>,wellName)</a>
<a class="sourceLine" id="cb56-5" data-line-number="5">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb56-6" data-line-number="6">      label &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s (%3.1f m3/h) &quot;</span>,wellName, Q<span class="op">*</span><span class="dv">3600</span>)</a>
<a class="sourceLine" id="cb56-7" data-line-number="7">    }</a>
<a class="sourceLine" id="cb56-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb56-9" data-line-number="9">  drawdown &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">SCENARIO=</span><span class="st">&quot;no well interference&quot;</span>, </a>
<a class="sourceLine" id="cb56-10" data-line-number="10">                         <span class="dt">TIME=</span>ddmatrix[[wellName]][,<span class="st">&quot;TIME&quot;</span>], </a>
<a class="sourceLine" id="cb56-11" data-line-number="11">                         <span class="dt">CALCDD=</span>ddmatrix[[wellName]][,wellName])</a>
<a class="sourceLine" id="cb56-12" data-line-number="12">  drawdownWithInterference &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="st">&quot;SCENARIO&quot;</span>=<span class="st">&quot;with well interference&quot;</span>, </a>
<a class="sourceLine" id="cb56-13" data-line-number="13">                         <span class="dt">TIME=</span>drawdownsWithWellInterference[,<span class="st">&quot;TIME&quot;</span>], </a>
<a class="sourceLine" id="cb56-14" data-line-number="14">                         <span class="dt">CALCDD=</span>drawdownsWithWellInterference[,wellName])</a>
<a class="sourceLine" id="cb56-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb56-16" data-line-number="16">  res &lt;-<span class="st"> </span><span class="kw">rbind</span>(drawdown, drawdownWithInterference)</a>
<a class="sourceLine" id="cb56-17" data-line-number="17">  <span class="kw">print</span>(lattice<span class="op">::</span><span class="kw">xyplot</span>(CALCDD <span class="op">~</span><span class="st"> </span>TIME, </a>
<a class="sourceLine" id="cb56-18" data-line-number="18">                        <span class="dt">groups =</span>  SCENARIO, </a>
<a class="sourceLine" id="cb56-19" data-line-number="19">                        <span class="dt">ylim=</span><span class="kw">rev</span>(<span class="kw">extendrange</span>(res<span class="op">$</span>CALCDD)),</a>
<a class="sourceLine" id="cb56-20" data-line-number="20">                        <span class="dt">ylab =</span> <span class="st">&quot;Drawdown (m)&quot;</span>,</a>
<a class="sourceLine" id="cb56-21" data-line-number="21">                        <span class="dt">xlab =</span> <span class="st">&quot;Time in seconds since start of pumping (s)&quot;</span>,</a>
<a class="sourceLine" id="cb56-22" data-line-number="22">                        <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, </a>
<a class="sourceLine" id="cb56-23" data-line-number="23">                        <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">columns=</span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb56-24" data-line-number="24">                        <span class="dt">data=</span>res, </a>
<a class="sourceLine" id="cb56-25" data-line-number="25">                        <span class="dt">main =</span> label))</a>
<a class="sourceLine" id="cb56-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb56-27" data-line-number="27"></a>
<a class="sourceLine" id="cb56-28" data-line-number="28"><span class="cf">for</span> (wellName <span class="cf">in</span> owWellfieldConf<span class="op">$</span>wellName)</a>
<a class="sourceLine" id="cb56-29" data-line-number="29">{</a>
<a class="sourceLine" id="cb56-30" data-line-number="30">  index &lt;-<span class="st"> </span><span class="kw">which</span>(owWellfieldConf<span class="op">$</span>wellName<span class="op">==</span>wellName)</a>
<a class="sourceLine" id="cb56-31" data-line-number="31"> wellQ &lt;-<span class="st"> </span>pumpingRates[index]</a>
<a class="sourceLine" id="cb56-32" data-line-number="32"> <span class="kw">plotWellInterference</span>(<span class="dt">wellName =</span> wellName, <span class="dt">Q =</span> wellQ)</a>
<a class="sourceLine" id="cb56-33" data-line-number="33">}</a></code></pre></div>
<p><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-44-1.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-44-2.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-44-3.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-44-4.png" width="672" /><img src="wtaq-tutorial_files/figure-html/unnamed-chunk-44-5.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/KWB-R/kwb.wtaq/edit/master/bookdown/02-sessions.Rmd",
"text": "Edit"
},
"download": ["wtaq-tutorial.pdf", "wtaq-tutorial.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
